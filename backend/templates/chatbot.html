<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1:wght@100..900&display=swap" rel="stylesheet">
    <style>
            /* Navbar styling */
            .navbar {
                background-color: #6b2dcc; /* Adjusted to match the image color */
                color: white;
                box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
                padding: 20px 0; /* Padding for better spacing */
                position: fixed; /* Fix the navbar to the top */
                top: 0;
                left: 0;
                width: 100%;
                z-index: 1000; /* Ensure the navbar stays above other content */
            }
        
            .navbar-container {
                max-width: 1200px;
                margin: 0 auto;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 20px;
            }
    
            .logo a {
                font-size: 28px; /* Slightly larger font for logo */
                font-weight: bold;
                color: white;
                text-decoration: none;
            }
    
            .nav-links {
                display: flex;
                gap: 25px; /* Spaced out the nav items more */
                align-items: center;
            }
    
            .nav-links a {
                color: white;
                text-decoration: none;
                font-size: 18px; /* Increased the font size */
                padding: 5px 10px;
            }
    
            .nav-links a:hover {
                color: lightgray;
            }
    
            .dropdown {
                position: relative;
                display: inline-block;
            }
    
            .dropdown-btn {
                background: none;
                border: none;
                color: white;
                font-size: 18px;
                cursor: pointer;
            }
    
            .dropdown-content {
                display: none;
                position: absolute;
                background-color: white;
                min-width: 160px;
                box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
                z-index: 1;
                border-radius: 4px;
            }
    
            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
            }
    
            .dropdown-content a:hover {
                background-color: #ddd;
            }
    
            .dropdown:hover .dropdown-content {
                display: block;
            }
    
            /* Mobile Menu Button */
            .mobile-menu-btn {
                display: none;
                background: none;
                border: none;
                color: white;
                font-size: 24px;
                cursor: pointer;
            }
    
            /* Mobile Dropdown */
            #mobileDropdown {
                display: none;
                flex-direction: column;
                background-color: #6b2dcc; /* Adjusted to match the navbar background */
                position: absolute;
                width: 100%;
                top: 60px;
                left: 0;
            }
    
            #mobileDropdown a, .mobile-dropdown-btn {
                color: white;
                padding: 10px 20px;
                text-decoration: none;
            }
    
            .mobile-dropdown-content {
                display: none;
                flex-direction: column;
                background-color: #6b2dcc; /* Adjusted to match the navbar background */
            }
    
            .mobile-dropdown-btn {
                background: none;
                border: none;
                color: white;
                font-size: 16px;
                cursor: pointer;
            }
    
            .mobile-dropdown-btn:hover {
                background-color: #6b2dcc;
            }
    
            .mobile-dropdown-content a:hover {
                background-color: #ddd;
                color: black;
            }
    
            /* Show the mobile dropdown menu when active */
            .show {
                display: flex !important;
            }
    
            /* Responsive Styles */
            @media (max-width: 768px) {
                .nav-links {
                    display: none;
                }
    
                .mobile-menu-btn {
                    display: block;
                }
    
                .dropdown-content, .mobile-dropdown-content {
                    display: none;
                }
            }
    
            /* Adjust the overall body to accommodate the fixed navbar */
            body {
                margin: 0;
                padding: 0;
                padding-top: 80px; /* Ensure body content doesn't overlap with navbar */
                font-family: 'Inter', sans-serif;
                background-color: white;
                color: black;
                display: flex;
                flex-direction: column; /* Added to align flex items in a column */
                justify-content: space-between; /* Keeps footer at the bottom */
                align-items: center;
                min-height: 100vh; /* Set min-height to fill the viewport */
            }
    
            .chat-container {
                width: 100%; /* Make the chatbot cover the full width */
                height: calc(100vh - 120px); /* Adjust height to account for the space occupied by the header and footer */
                background-color: #6b2dcc; /* Background color of the chat container */
                border-radius: 0px;
                box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
                padding: 20px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                color: black;
                margin-top: 0; /* Remove top margin to stretch the container */
                box-sizing: border-box; /* Ensure padding is included in the width and height */
            }            
    
            /* Ensure message-area has proper margin */
            .message-area {
                flex-grow: 1;
                overflow-y: auto;
                margin-bottom: 20px;
                padding: 10px;
                border-radius: 10px;
                background-color: #f9f9f9;
            }
    
            /* Message bubble */
            .message {
                margin: 10px 0;
                padding: 10px;
                border-radius: 20px;
                font-family: 'M PLUS 1', sans-serif;
                font-size: 14px;
                max-width: 75%;
                word-wrap: break-word;
                box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
            }
    
            /* User message styling */
            .message.user {
                background-color: white; /* User messages will have a white background */
                color: black; /* Text color for user messages */
                margin-left: auto;
                text-align: right;
                border-radius: 20px 20px 0 20px; /* Round top-right and bottom-right corners */
            }
    
            /* Bot message styling */
            .message.bot {
                background-color: white; /* Bot messages will also have a white background */
                color: black; /* Text color for bot messages */
                border-radius: 20px 20px 20px 0; /* Round top-left and bottom-left corners */
            }
    
            /* The Input area */
            .input-area {
                display: flex;
                align-items: flex-start; /* Align items to start */
                gap: 10px;
            }
    
            textarea {
                flex-grow: 1; /* Makes it flexible in the input area */
                padding: 10px; /* Same padding as input */
                border: none; /* No border */
                border-radius: 20px; /* Same border radius as input */
                font-size: 16px; /* Same font size */
                color: black; /* Text color */
                background-color: #f1f1f1; /* Light background for input */
                resize: none; /* Prevent manual resizing */
                overflow: hidden; /* Hide overflow */
                max-height: 120px; /* Set a maximum height */
                line-height: 1.5; /* Control the line height for better spacing */
                transition: height 0.2s ease; /* Smooth transition for height change */
            }
    
            button {
                padding: 10px 20px;
                background-color: black; /* Dark Slate Gray button color */
                color: white; /* Button text color */
                border: none;
                border-radius: 20px;
                cursor: pointer;
                font-size: 16px;
            }
            
            button:hover {
                background-color: #1C3131; /* Darker version of Dark Slate Gray on hover */
            }
    
            strong {
                font-weight: bold;
            }
    
            em {
                font-style: italic;
            }


            /* Footer Styling */
            .footer {
                background-color: #2d3748; /* Footer background */
                color: #ffffff; /* White text */
                padding: 2rem 0; /* Adjust for proper spacing */
                position: relative; /* Ensure it's placed in document flow */
                bottom: 0;
                width: 100%; /* Full width */
                clear: both;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }

            .footer-content {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
            }

            .footer-section {
                width: 100%;
                margin-bottom: 2rem;
            }

            @media (min-width: 768px) {
                .footer-section {
                    width: 30%; /* For three equal columns on larger screens */
                }
            }
            
            .footer-title {
                font-size: 1.5rem;
                font-weight: bold;
                margin-bottom: 1rem;
            }
            
            .footer-text {
                color: #a0aec0; /* text-gray-400 */
            }
            
            .footer-links {
                list-style: none;
                padding: 0;
            }
            
            .footer-links li {
                margin-bottom: 0.5rem;
            }
            
            .footer-links a {
                color: #a0aec0; /* text-gray-400 */
                text-decoration: none;
            }
            
            .footer-links a:hover {
                color: #ffffff; /* white on hover */
            }
            
            /* Newsletter Form */
            .newsletter-form {
                display: flex;
                flex-direction: column;
            }
            
            @media (min-width: 768px) {
                .newsletter-form {
                flex-direction: row;
                }
            }
            
            .newsletter-input {
                padding: 0.5rem;
                border-radius: 0.375rem;
                border: none;
                margin-bottom: 0.5rem;
                outline: none;
                flex-grow: 1;
            }
            
            .newsletter-input:focus {
                box-shadow: 0 0 0 3px #9f7aea; /* focus:ring-purple-500 equivalent */
            }
            
            .newsletter-button {
                background-color: #6b46c1; /* bg-purple-600 */
                color: white;
                padding: 0.5rem 1rem;
                border: none;
                border-radius: 0.375rem;
                cursor: pointer;
                margin-left: 0.5rem;
            }
            
            .newsletter-button:hover {
                background-color: #553c9a; /* bg-purple-700 */
            }
            
            /* Footer Bottom */
            .footer-bottom {
                text-align: center;
                margin-top: 2rem;
            }
            
            .footer-bottom p {
                color: #a0aec0; /* text-gray-400 */
            }
            
            /* Dropdown in Quick Links */
            .service-dropdown {
                position: relative;
            }
            
            .dropdown-content {
                display: none;
                position: absolute;
                background-color: #2d3748;
                margin-top: 0.5rem;
                padding: 0.5rem 0;
                list-style: none;
                width: 200px;
                border-radius: 0.375rem;
            }
            
            .service-dropdown:hover .dropdown-content {
                display: block;
            }
            
            .dropdown-content li {
                padding: 0.5rem 1rem;
            }
            
            .dropdown-content li a {
                color: #a0aec0;
            }
            
            .dropdown-content li a:hover {
                color: white;
                background-color: #1a202c;
                border-radius: 0.375rem;
            }
            
    </style>
</head>
<body>
    <header class="navbar">
        <div class="navbar-container">
            <!-- Logo -->
            <div class="logo">
                <a href="http://localhost:5173/">Merit.com</a>
            </div>
            
            <!-- Navigation Links -->
            <nav class="nav-links">
                <a href="http://localhost:5173/">Home</a>
                <a href="http://127.0.0.1:5000/merit.ai">Merit AI</a>
                
                <!-- Dropdown Menu -->
                <div class="dropdown">
                    <button class="dropdown-btn">Service ▼</button>
                    <div class="dropdown-content">
                        <a href="http://localhost:5173/service/aggregate-calculator">Aggregate calculator</a>
                        <a href="http://localhost:5173/universities-list">Find dream school</a>
                    </div>
                </div>
                
                <a href="http://localhost:5173/about">About</a>
            </nav>
            
            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn">☰</button>
        </div>
        
        <!-- Mobile Dropdown for Mobile View -->
        <div class="mobile-dropdown" id="mobileDropdown">
            <a href="/">Home</a>
            <a href="http://127.0.0.1:5000/merit.ai">Merit AI</a>
            <button class="mobile-dropdown-btn">Service ▼</button>
            <div class="mobile-dropdown-content">
                <a href="/service/aggregate-calculator">Aggregate calculator</a>
                <a href="/universities-list">Find dream school</a>
            </div>
            <a href="/about">About</a>
        </div>
    </header>
    <div class="chat-container">
        <div class="message-area" id="chat-box"></div>
        <div class="input-area">
            <textarea id="user-input" rows="1" placeholder="Type your message here..." style="resize: none;"></textarea>
            <button id="send-button">Send</button>
        </div>
    </div>
    <footer class="footer bg-gray-800 text-white py-8">
        <div class="container">
          <div class="footer-content">
            <!-- Left Column -->
            <div class="footer-section about">
              <h3 class="footer-title">MERIT</h3>
              <p class="footer-text">
                Admission Process made seamless with Merit. Helping students make the right choices
                when it comes to matters pertaining to course and institution.
              </p>
            </div>
      
            <!-- Middle Column (Quick Links) -->
            <div class="footer-section quick-links">
              <h4 class="footer-title">Quick Links</h4>
              <ul class="footer-links">
                <li><a href="http://localhost:5173/">Home</a></li>
                <li><a href="http://localhost:5173/about">About Us</a></li>
                <li class="service-dropdown">
                  <a href="#">Services</a>
                  <ul class="dropdown-content">
                    <li><a href="http://localhost:5173/service/aggregate-calculator">Aggregate calculator</a></li>
                    <li><a href="http://localhost:5173/universities-list">Find dream school</a></li>
                  </ul>
                </li>
              </ul>
            </div>
      
            <!-- Right Column (Newsletter) -->
            <div class="footer-section newsletter">
              <h4 class="footer-title">Subscribe to Our Newsletter</h4>
              <form class="newsletter-form">
                <input
                  type="email"
                  placeholder="Enter your email"
                  class="newsletter-input"
                />
                <button type="submit" class="newsletter-button">Subscribe</button>
              </form>
            </div>
          </div>
      
          <!-- Footer Bottom Section -->
          <div class="footer-bottom">
            <p>&copy; <span id="year"></span> Merit. All rights reserved.</p>
          </div>
        </div>
      
    </footer>
      
    <script>
        // Toggle mobile dropdown visibility
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const mobileDropdown = document.getElementById('mobileDropdown');
        const mobileDropdownBtn = document.querySelector('.mobile-dropdown-btn');
        const mobileDropdownContent = document.querySelector('.mobile-dropdown-content');
    
        mobileMenuBtn.addEventListener('click', function() {
            mobileDropdown.classList.toggle('show');
        });
    
        // Toggle service dropdown on mobile
        mobileDropdownBtn.addEventListener('click', function() {
            mobileDropdownContent.classList.toggle('show');
        });

        // This will update the year dynamically
        const yearSpan = document.getElementById("year");
        const currentYear = new Date().getFullYear();
        yearSpan.textContent = currentYear;
            

        const chatBox = document.getElementById("chat-box");
        const userInput = document.getElementById("user-input");
        const sendButton = document.getElementById("send-button");

        function formatMessage(message) {
            // Format bold and italic text using asterisks
            message = message.replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>'); // Bold Italics
            message = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Bold
            message = message.replace(/\*(.*?)\*/g, '$1'); // Italics
            
            // Replace new lines (\n) with <br> for proper line breaks
            message = message.replace(/\n/g, '<br>');
        
            // Replace bullet points (- or *) with list items (<li> tags)
            message = message.replace(/^[-*] (.*?)(\n|$)/gm, '<li>$1</li>');
        
            // Wrap the list items in <ul> tags to create a proper list
            message = message.replace(/(<li>.*?<\/li>)/g, '<ul>$1</ul>');
        
            return message;
        }
               

        let isUserAtBottom = true; // Tracks whether the user is at the bottom of the chat

        // Check if the user is at the bottom of the chat box
        function checkScrollPosition() {
            const chatHeight = chatBox.scrollHeight;
            const visibleHeight = chatBox.clientHeight;
            const scrollPosition = chatBox.scrollTop;

            // If the user is within 20px from the bottom, consider them at the bottom
            isUserAtBottom = chatHeight - (visibleHeight + scrollPosition) < 20;
        }

        // Auto-scroll only if the user is at the bottom
        function autoScroll() {
            if (isUserAtBottom) {
                chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom
            }
        }

        // Listen for scroll events to detect when the user scrolls up or down
        chatBox.addEventListener('scroll', checkScrollPosition);

        // Adjust height of textarea based on content
        function autoResizeTextarea() {
            this.style.height = 'auto'; // Reset height
            this.style.height = `${Math.min(this.scrollHeight, 120)}px`; // Set new height with max limit
        }

        // Modified typeMessage function to respect user's scroll
        function typeMessage(messageDiv, message) {
            const formattedMessage = formatMessage(message); // Format the message
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = formattedMessage;

            const elements = Array.from(tempDiv.childNodes); // Get all child nodes (text and elements)

            let currentElementIndex = 0;
            let typingIndex = 0;

            const typingSpeed = 10; // Typing speed

            function typeCharacter() {
                if (currentElementIndex < elements.length) {
                    const currentNode = elements[currentElementIndex];

                    if (currentNode.nodeType === Node.TEXT_NODE) {
                        // If it's a text node, type character by character
                        if (typingIndex < currentNode.textContent.length) {
                            messageDiv.innerHTML += currentNode.textContent.charAt(typingIndex);
                            typingIndex++;
                            setTimeout(typeCharacter, typingSpeed);
                            autoScroll(); // Only auto-scroll if the user is at the bottom
                        } else {
                            // Move to the next node when done with this one
                            currentElementIndex++;
                            typingIndex = 0;
                            typeCharacter(); // Continue typing the next node
                        }
                    } else if (currentNode.nodeType === Node.ELEMENT_NODE) {
                        // If it's an HTML element, add it directly and move on
                        messageDiv.appendChild(currentNode.cloneNode(true)); // Append the HTML element
                        currentElementIndex++;
                        typeCharacter(); // Continue typing the next node
                        autoScroll(); // Only auto-scroll if the user is at the bottom
                    }
                }
            }

            typeCharacter(); // Start typing
        }

        function appendMessage(sender, message) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", sender);
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // Scroll to the bottom

            if (sender === 'bot') {
                typeMessage(messageDiv, formatMessage(message)); // Use typing effect for bot
            } else {
                messageDiv.innerHTML = formatMessage(message); // Display user message directly
            }
        }

        async function sendMessage() {
            const message = userInput.value.trim(); // Trim whitespace from input
            if (!message) return; // Ignore empty messages
        
            appendMessage("user", message); // Append user message to chat
            userInput.value = ""; // Clear input box immediately
            autoResizeTextarea.call(userInput); // Reset the height of textarea
        
            const response = await fetch("/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message }),
            });
        
            const data = await response.json();
            appendMessage("bot", data.response); // Append bot message with typing effect
        }
        

        sendButton.addEventListener("click", sendMessage);

        userInput.addEventListener("input", autoResizeTextarea); // Adjust height on input
        userInput.addEventListener("keydown", (event) => {
            if (event.key === "Enter") {
                if (!event.shiftKey) {
                    event.preventDefault(); // Prevent default behavior of adding new line
                    sendMessage(); // Send the message when Enter is pressed
                }
                // If Shift + Enter is pressed, allow new line
            }
        });
    </script>
</body>
</html>
